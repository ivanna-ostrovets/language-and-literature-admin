<form novalidate
      (ngSubmit)="onSubmit()"
      #createtestform="ngForm"
      class="create-test-form">

  <md-input-container class="block margin-bottom">
    <input mdInput
           required
           type="number"
           name="tasksQuantity"
           placeholder="Виберіть кількість запитань в тесті"
           min="1"
           [(ngModel)]="tasksQuantity">
  </md-input-container>

  <div *ngIf="tasksQuantity > 0">
    <md-select required
               name="subject"
               class="block margin-bottom"
               placeholder="Оберіть предмет"
               [(ngModel)]="subject">
      <md-option *ngFor="let subject of subjects" [value]="subject.value">
        {{ subject.viewValue }}
      </md-option>
    </md-select>

    <md-select required
               name="category"
               class="block margin-bottom"
               placeholder="Оберіть категорію"
               [(ngModel)]="category">
      <md-option *ngFor="let category of categories" [value]="category.value">
        {{ category.viewValue }}
      </md-option>
    </md-select>

    <md-tab-group>
      <md-tab *ngFor="let number of getNumbersRange(tasksQuantity); let i=index"
              label="{{ i + 1 }}"
              id="tab{{ i }}"
              (click)="currentTab = i"
              [ngClass]="{'active' : currentTab == i}">
        <md-input-container class="block margin-bottom question-title">
          <textarea mdInput
                    required
                    name="question{{ i }}"
                    placeholder="Завдання"
                    [(ngModel)]="questions[i]">
          </textarea>
        </md-input-container>

        <div class="slider-margin-bottom">
          <md-slide-toggle class="block"
                           name="addImage{{ i }}"
                           [(ngModel)]="addImages[i]">
            Додати зображення
          </md-slide-toggle>

          <input type="file"
                 hidden
                 id="image{{ i }}"
                 (change)="uploadImage($event, i)"
                 accept="image/*">
          <button md-raised-button
                  *ngIf="addImages[i]"
                  (click)="clickOnElement('#image' + i)">
            Додати зображення
          </button>
          <md-input-container class="margin-bottom"
                              *ngIf="addImages[i] && images[i]?.name">
            <input mdInput
                   disabled
                   [value]="images[i]?.name">
          </md-input-container>
        </div>

        <md-slide-toggle class="block slider-margin-bottom"
                         name="matching{{ i }}"
                         [(ngModel)]="matchings[i]">
          Завдання на відповідність
        </md-slide-toggle>

        <md-input-container class="block margin-bottom">
          <input mdInput
                 required
                 type="number"
                 name="answersQuantity{{ i }}"
                 placeholder="Виберіть кількість відповідей"
                 min="1"
                 (input)="setArraysDimensions(i)"
                 [(ngModel)]="answersQuantities[i]">
        </md-input-container>

        <div *ngIf="!matchings[i]" class="margin-bottom">
          <md-input-container class="block"
                              *ngFor="let number of getNumbersRange(answersQuantities[i])">
            <textarea mdInput
                      required
                      name="answer_{{ number }}_{{ i }}"
                      placeholder="Відповідь {{ number + 1 }}"
                      [(ngModel)]="answers[i][number]">
            </textarea>
          </md-input-container>
        </div>

        <div *ngIf="!matchings[i]" class="margin-bottom">
          <p *ngIf="answersQuantities[i]"
             class="label">
            Правильна відповідь
          </p>
          <md-radio-group required
                          name="rightAnswer"
                          class="answers-radio"
                          *ngFor="let number of getNumbersRange(answersQuantities[i])"
                          [(ngModel)]="correctAnswers[i]">
            <md-radio-button [value]="number"
                             class="block">
              {{ number + 1 }}
            </md-radio-button>
          </md-radio-group>
        </div>

        <table class="answers-table margin-bottom"
               *ngIf="matchings[i]">
          <thead>
            <tr>
              <th>
                <md-input-container class="block">
                  <input mdInput
                         required
                         name="answersTableTitle0_{{ i }}"
                         placeholder="Заголовок"
                         [(ngModel)]="answersTableTitles[i][0]">
                </md-input-container>
              </th>
              <th>
                <md-input-container class="block">
                  <input mdInput
                         required
                         name="answersTableTitle1_{{ i }}"
                         placeholder="Заголовок"
                         [(ngModel)]="answersTableTitles[i][1]">
                </md-input-container>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let number of getNumbersRange(answersQuantities[i])">
              <td>
                <md-input-container class="block">
                  <input mdInput
                         required
                         name="answersNumbers{{ number }}_{{ i }}"
                         placeholder="Варіант {{ getNumber(number, 0, false) }}"
                         [(ngModel)]="answersNumbers[i][number]">
                </md-input-container>
              </td>
              <td>
                <md-input-container class="block">
                  <input mdInput
                         required
                         name="answersLetters{{ number }}_{{ i }}"
                         placeholder="Варіант {{ getNumber(number, 1, false) }}"
                         [(ngModel)]="answersLetters[i][number]">
                </md-input-container>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="margin-bottom" *ngIf="matchings[i]
                                          && answersLetters[i].length > answersQuantities[i] - 2
                                          && answersNumbers[i].length > answersQuantities[i] - 2">
          <p>
            Правильні відповіді
          </p>

          <table>
            <thead>
              <tr>
                <th></th>
                <th *ngFor="let number of getNumbersRange(answersLetters[i].length)">
                  {{ getNumber(number, 1, false) }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let number of getNumbersRange(answersNumbers[i].length)">
                <td>{{ number + 1 }}</td>

                <md-radio-group required
                                name="complex_{{ number }}"
                                [(ngModel)]="correctAnswers[i][number]">
                  <td>
                    <md-radio-button *ngFor="let num of getNumbersRange(answersLetters[i].length)"
                                     [value]="num + 1">
                    </md-radio-button>
                  </td>
                </md-radio-group>
              </tr>
            </tbody>
          </table>
        </div>
      </md-tab>
    </md-tab-group>

    <div class="block center-align">
      <button md-raised-button
              [disabled]="!createtestform.form.valid">
        Створити тест
      </button>

      <button md-raised-button
              type="reset">
        Очистити форму
      </button>
    </div>
  </div>
</form>